services:
  # RPi5 Node (Port 3002-3003)
  csharp-api:
    image: king704spider/web-api-csharp:latest
    ports:
      - "0.0.0.0:3002:3002"
    environment:
      - ASPNETCORE_URLS=http://+:3002
    hostname: web-api-csharp
    dns:
      - 127.0.0.11
    dns_search: []
    networks:
      - web-network
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      args:
        NEXT_PUBLIC_NODE_API: ${NEXT_PUBLIC_NODE_API}
        NEXT_PUBLIC_PY_API: ${NEXT_PUBLIC_PY_API}
        NEXT_PUBLIC_CS_API: ${NEXT_PUBLIC_CS_API}
    ports:
      - "0.0.0.0:3003:3003"
    environment:
      # Runtime envs (not used by Next.js build), kept for completeness
      - NEXT_PUBLIC_NODE_API
      - NEXT_PUBLIC_PY_API
      - NEXT_PUBLIC_CS_API
    hostname: web-api-frontend
    dns:
      - 127.0.0.11
    dns_search: []
    networks:
      - web-network
    restart: unless-stopped

  # Watchtower for auto-updates on git push
  watchtower:
    image: containrrr/watchtower:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: --interval 300 --cleanup
    networks:
      - web-network
    restart: unless-stopped

networks:
  web-network:
    driver: bridge
